[
["index.html", "ggplot2逆引き集", " ggplot2逆引き集 @kazutan 2016-11-12 これはQiitaで公開されているggplot2逆引きの記事を集めたものです。 またこれはbookdownパッケージのテストを兼ねています。うまく動くといいなぁ…。 "],
["01-Plotting_two_variables.html", "Q: 1 ggplot2で同一グラフに2変数の折れ線グラフを描きたい 1.1 Q 1.2 A 1.3 参考", " Q: 1 ggplot2で同一グラフに2変数の折れ線グラフを描きたい 1.1 Q このようなデータが手元にあります: test_data &lt;- data.frame( var0 = 100 + c(0, cumsum(runif(49, -20, 20))), var1 = 150 + c(0, cumsum(runif(49, -10, 10))), date = seq.Date(as.Date(&quot;2002-01-01&quot;), by=&quot;1 month&quot;, length.out=100)) この時系列変数var0とvar1の両方共を、dateをx軸にしてggplot2でどうやったら描けますか? できればvar0とvar1の色を変えて、さらに凡例も付けれたら嬉しいです。 1.2 A もし変数が少ないのであれば、マニュアルで別々に作成ビルドアップできますよ: library(ggplot2) ggplot(test_data, aes(date)) + geom_line(aes(y = var0, colour = &quot;var0&quot;)) + geom_line(aes(y = var1, colour = &quot;var1&quot;)) 一般的なアプローチとしては、tydyrパッケージを利用してデータを縦型(long format)に変換していく方法があります: library(tidyr) library(ggplot2) test_data_long &lt;- tidyr::gather(test_data, key=&quot;variable&quot;, value = value, -date) # 縦型に変換 knitr::kable(head(test_data_long, 6)) date variable value 2002-01-01 var0 100.00000 2002-02-01 var0 86.89299 2002-03-01 var0 67.68766 2002-04-01 var0 79.82263 2002-05-01 var0 79.43657 2002-06-01 var0 83.91901 ggplot(data=test_data_long, aes(x=date, y=value, colour=variable)) + geom_line() データを縦型のデータに変換し、var0とvar1を分けるための変数で色分けを指定すればこのようになります。 1.3 参考 この記事は、StackOverflowに投稿された以下の記事をベースに、コードを一部改変して翻訳して作成しました: - r - Plotting two variables as lines using ggplot2 on the same graph - Stack Overflow 関連ドキュメント: - geom_line. ggplot2 0.9.3.1 "],
["02-Showing_data_values_on_stacked_bar.html", "Q: 2 ggplot2で積み重ね棒グラフに値を表示させたい 2.1 Q 2.2 A 2.3 補足 2.4 参考", " Q: 2 ggplot2で積み重ね棒グラフに値を表示させたい 2016/04/12追記: ggplot2 v2.1.0に対応するため、一部コードを修正しました 本記事は ggplot2逆引き プロジェクトの一環として、Stack Oveflow の下記記事を翻訳したものです。 r - Showing data values on stacked bar chart in ggplot2 - Stack Overflow 2.1 Q ggplot2で積み重ね棒グラフに値を重ねて表示したいです。私が試したのは以下のコードです: 2016/04/12追記: ggplot2 v2.1.0でqplot()の仕様が変更されているようでしたので、ggplot()で描くように修正しました Year &lt;- c(rep(c(&quot;2006-07&quot;, &quot;2007-08&quot;, &quot;2008-09&quot;, &quot;2009-10&quot;), each = 4)) Category &lt;- c(rep(c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;), times = 4)) Frequency &lt;- c(168, 259, 226, 340, 216, 431, 319, 368, 423, 645, 234, 685, 166, 467, 274, 251) Data &lt;- data.frame(Year, Category, Frequency) library(ggplot2) p &lt;- ggplot(Data, aes(Year, Frequency, fill = Category)) + geom_bar(stat = &quot;identity&quot;) + theme_bw() p + geom_text(aes(label = Frequency), size = 3, hjust = 0.5, vjust = 3, position = &quot;stack&quot;) でもこのデータの値を、各部位の中央に配置したいのです。お願いします。 2.2 A 一つのやり方として、各バーのミッドポイントを算出するというのがあります: library(plyr) library(ggplot2) # calculate midpoints of bars (simplified using comment by @DWin) Data &lt;- ddply(Data, .(Year), transform, pos = cumsum(Frequency) - (0.5 * Frequency)) # plot bars and add text p &lt;- ggplot(Data, aes(x = Year, y = Frequency)) + geom_bar(aes(fill = Category), stat=&quot;identity&quot;) + geom_text(aes(label = Frequency, y = pos), size = 3) library(plyr) library(ggplot2) Year &lt;- c(rep(c(&quot;2006-07&quot;, &quot;2007-08&quot;, &quot;2008-09&quot;, &quot;2009-10&quot;), each = 4)) Category &lt;- c(rep(c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;), times = 4)) Frequency &lt;- c(168, 259, 226, 340, 216, 431, 319, 368, 423, 645, 234, 685, 166, 467, 274, 251) Data &lt;- data.frame(Year, Category, Frequency) # calculate midpoints of bars (simplified using comment by @DWin) Data &lt;- ddply(Data, .(Year), transform, pos = cumsum(Frequency) - (0.5 * Frequency)) # plot bars and add text p &lt;- ggplot(Data, aes(x = Year, y = Frequency)) + geom_bar(aes(fill = Category), stat=&quot;identity&quot;) + geom_text(aes(label = Frequency, y = pos), size = 3) p データフレームにあらかじめ値を配置する高さ(y値)を算出して変数として追加し、geom_text(aes(label = Frequency, y = pos))とその変数を指定すれば、そのラベルは算出した位置に配置されます。 2.3 補足 上記のAの方法は、データフレームに新たに変数を追加することとなります。それを避けて(だいたい)真ん中にくるようになればいい、というのであれば、以下のようなコードでも可能です: p &lt;- ggplot(Data, aes(x = Year, y = Frequency)) + geom_bar(aes(fill = Category), stat=&quot;identity&quot;) + geom_text(aes(label = Frequency), size = 3, position = &quot;stack&quot;, vjust = Frequency/75) p これは、geom-textのvjustに対して設定を加えています。このようにy値の変数を定数で補正したものをvjust =に投げると、割合的にずれてくれるようになります。 ただこの方法ですと、その補正する定数をどう設定したらど真ん中にくるか、はっきりとはわかりません。詳しくはRPubs - vjustのテストをご覧ください。 また、この記事の元となっているStackOverflowの記事には、Hadley Wickham氏による以下のコメントがあったことも付記します: Please don’t. It’s not a good idea to try and improve a confusing visualisation by adding text labels. Either make a table or use a better display of the data. – hadley Jul 12 ’11 at 1:10 2.4 参考 r - Showing data values on stacked bar chart in ggplot2 - Stack Overflow RPubs - vjustのテスト ggplot2逆引き - ggplot2 で geom_text() を使って集合棒グラフにラベルを付けたい #rstatsj - Qiita "]
]
